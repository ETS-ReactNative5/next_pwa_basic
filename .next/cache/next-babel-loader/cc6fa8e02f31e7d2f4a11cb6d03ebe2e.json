{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\visha\\\\Desktop\\\\next_pwa_basic\\\\pages\\\\notification.js\";\nvar __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport { Container } from \"../components/Container\";\nimport { Typography } from \"@material-ui/core\";\nconst publicVapidKey = \"BCj54G9kp6-MuxVje45_rEdNd24WnFaDLOquVDqrdeqGy_NwwaeTovYJoKdP429zTri6hqypw4TXKMFF6a57aMQ\";\n\nfunction urlBase64ToUint8Array(base64String) {\n  var padding = '='.repeat((4 - base64String.length % 4) % 4);\n  var base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n  var rawData = window.atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n\nexport default class notification extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"configurePushSubscription\", () => {\n      this.setState({\n        loading: true\n      });\n      console.log(\"you are inside the web notification subscription code !!\");\n\n      if (!'Notification' in navigator) {\n        return;\n      }\n\n      let swRef;\n      navigator.serviceWorker.ready.then(sw => {\n        swRef = sw;\n        return swRef.pushManager.getSubscription(); // this allow to get the subscripition \n      }).then(sub => {\n        if (sub === null) {\n          // create a new subscription \n          console.log(\"we dont have the subcription\");\n          return swRef.pushManager.subscribe({\n            userVisibleOnly: true,\n            applicationServerKey: urlBase64ToUint8Array(publicVapidKey)\n          }).then(subscription => {\n            console.log(\"user is subscribed\", subscription);\n          });\n        } else {\n          // we have a subscription ;\n          console.log(\"we have the subcription\", sub);\n          return sub;\n        }\n      }).then(function (newSub) {\n        // here you have to store this newsbu i.e. your subscription user to database\n        // with the help of newSub Request payload // you get the endpoing and keys {p256dh , auth}\n        // which is used to send the notification to the user \n        console.log(\"this is subsciriton body\", newSub);\n        let urlDb = \"https://pwa-serv-notify.herokuapp.com/api/pwa/subscribe\";\n        return fetch(urlDb, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Accept': 'application/json'\n          },\n          body: JSON.stringify(newSub)\n        });\n      }).then(function (res) {\n        if (res.ok) {\n          console.log(\"new subscriber is added to DB \", res);\n          this.setState({\n            loading: false\n          });\n          let subBtn = document.getElementById(\"sub-notification\");\n          subBtn.style.display = \"none\";\n        }\n      }).catch(function (err) {\n        this.setState({\n          loading: false\n        });\n        console.log(\"server : App subscriber error \", err);\n      });\n    });\n\n    this.state = {\n      isLoading: false\n    };\n  }\n\n  render() {\n    return __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 13\n      }\n    }, __jsx(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 17\n      }\n    }, __jsx(Typography, {\n      children: \"Notification\",\n      variant: \"h6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 21\n      }\n    }), this.state.isLoading && __jsx(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 46\n      }\n    }, \"Loading...\"), __jsx(\"h6\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 21\n      }\n    }, \"Start Notification from server \"), __jsx(\"button\", {\n      onClick: () => this.configurePushSubscription(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 21\n      }\n    }, \"Start Server Notification\")));\n  }\n\n}","map":{"version":3,"sources":["C:/Users/visha/Desktop/next_pwa_basic/pages/notification.js"],"names":["React","Component","Container","Typography","publicVapidKey","urlBase64ToUint8Array","base64String","padding","repeat","length","base64","replace","rawData","window","atob","outputArray","Uint8Array","i","charCodeAt","notification","constructor","props","setState","loading","console","log","navigator","swRef","serviceWorker","ready","then","sw","pushManager","getSubscription","sub","subscribe","userVisibleOnly","applicationServerKey","subscription","newSub","urlDb","fetch","method","headers","body","JSON","stringify","res","ok","subBtn","document","getElementById","style","display","catch","err","state","isLoading","render","configurePushSubscription"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport { Container } from \"../components/Container\";\r\nimport { Typography } from \"@material-ui/core\";\r\n\r\nconst publicVapidKey = \"BCj54G9kp6-MuxVje45_rEdNd24WnFaDLOquVDqrdeqGy_NwwaeTovYJoKdP429zTri6hqypw4TXKMFF6a57aMQ\";\r\n\r\nfunction urlBase64ToUint8Array(base64String) {\r\n    var padding = '='.repeat((4 - base64String.length % 4) % 4);\r\n    var base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n\r\n    var rawData = window.atob(base64);\r\n    var outputArray = new Uint8Array(rawData.length);\r\n\r\n    for (var i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\r\n\r\nexport default class notification extends Component {\r\n\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            isLoading: false\r\n        }\r\n    }\r\n\r\n\r\n    configurePushSubscription = () => {\r\n\r\n        this.setState({ loading: true });\r\n        console.log(\"you are inside the web notification subscription code !!\");\r\n        if (!'Notification' in navigator) {\r\n            return;\r\n        }\r\n\r\n        let swRef;\r\n\r\n        navigator.serviceWorker.ready.then(sw => {\r\n            swRef = sw;\r\n            return swRef.pushManager.getSubscription(); // this allow to get the subscripition \r\n\r\n        }).then(sub => {\r\n            if (sub === null) {\r\n                // create a new subscription \r\n                console.log(\"we dont have the subcription\")\r\n\r\n                return swRef.pushManager.subscribe({\r\n                    userVisibleOnly: true,\r\n                    applicationServerKey: urlBase64ToUint8Array(publicVapidKey),\r\n                }).then(subscription => {\r\n                    console.log(\"user is subscribed\", subscription)\r\n                });\r\n            } else {\r\n                // we have a subscription ;\r\n                console.log(\"we have the subcription\", sub);\r\n                return sub;\r\n            }\r\n        }).then(function (newSub) {\r\n\r\n            // here you have to store this newsbu i.e. your subscription user to database\r\n            // with the help of newSub Request payload // you get the endpoing and keys {p256dh , auth}\r\n            // which is used to send the notification to the user \r\n            console.log(\"this is subsciriton body\", newSub);\r\n\r\n            let urlDb = \"https://pwa-serv-notify.herokuapp.com/api/pwa/subscribe\";\r\n            return fetch(urlDb, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Accept': 'application/json'\r\n                },\r\n                body: JSON.stringify(newSub)\r\n            })\r\n        }).then(function (res) {\r\n            if (res.ok) {\r\n                console.log(\"new subscriber is added to DB \", res);\r\n                this.setState({ loading: false });\r\n\r\n                let subBtn = document.getElementById(\"sub-notification\");\r\n                subBtn.style.display = \"none\";\r\n            }\r\n        }).catch(function (err) {\r\n            this.setState({ loading: false });\r\n\r\n            console.log(\"server : App subscriber error \", err);\r\n        });\r\n\r\n    }\r\n\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <Container>\r\n                    <Typography children=\"Notification\" variant=\"h6\" />\r\n\r\n                    {this.state.isLoading && <h3>Loading...</h3>}\r\n\r\n                    <h6>Start Notification from server </h6>\r\n                    <button onClick={() => this.configurePushSubscription()} >Start Server Notification</button>\r\n                </Container>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}